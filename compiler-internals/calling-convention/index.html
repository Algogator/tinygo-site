<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.54.0" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Calling convention :: TinyGo - Go on Microcontrollers and WASM</title>

    
    <link href="/css/nucleus.css?1553068548" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1553068548" rel="stylesheet">
    <link href="/css/hybrid.css?1553068548" rel="stylesheet">
    <link href="/css/featherlight.min.css?1553068548" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1553068548" rel="stylesheet">
    <link href="/css/auto-complete.css?1553068548" rel="stylesheet">
    <link href="/css/theme.css?1553068548" rel="stylesheet">
    <link href="/css/hugo-theme.css?1553068548" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1553068548" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1553068548"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/compiler-internals/calling-convention/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <html>
<a href="https://tinygo.org"><img src="https://tinygo.org/images/tinygo-logo.png"><h1 style="color:white; margin:0;">TinyGo</h1><h4 style="color:white; margin:0;">Go Compiler For Small Places</h4></a>
</html>

    </div>
    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/getting-started/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/getting-started/requirements/" title="Requirements" class="dd-item ">
        <a href="/getting-started/requirements/">
        Requirements
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting-started/installation/" title="Installation" class="dd-item ">
        <a href="/getting-started/installation/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting-started/usage/" title="Usage" class="dd-item ">
        <a href="/getting-started/usage/">
        Usage
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting-started/using-docker/" title="Using TinyGo with Docker" class="dd-item ">
        <a href="/getting-started/using-docker/">
        Using TinyGo with Docker
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/usage/" title="Using TinyGo" class="dd-item 
        
        
        
        ">
      <a href="/usage/">
          Using TinyGo
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/usage/subcommands/" title="Subcommands" class="dd-item ">
        <a href="/usage/subcommands/">
        Subcommands
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/important-options/" title="Important Build Options" class="dd-item ">
        <a href="/usage/important-options/">
        Important Build Options
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/usage/misc-options/" title="Misc. Build Options" class="dd-item ">
        <a href="/usage/misc-options/">
        Misc. Build Options
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/microcontrollers/" title="Go on microcontrollers" class="dd-item 
        
        
        
        ">
      <a href="/microcontrollers/">
          Go on microcontrollers
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/arduino-uno/" title="Arduino Uno" class="dd-item ">
        <a href="/microcontrollers/arduino-uno/">
        Arduino Uno
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/bbc-microbit/" title="BBC micro:bit" class="dd-item ">
        <a href="/microcontrollers/bbc-microbit/">
        BBC micro:bit
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/bluepill/" title="Bluepill" class="dd-item ">
        <a href="/microcontrollers/bluepill/">
        Bluepill
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/circuit-playground-express/" title="Circuit Playground Express" class="dd-item ">
        <a href="/microcontrollers/circuit-playground-express/">
        Circuit Playground Express
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/digispark/" title="Digispark" class="dd-item ">
        <a href="/microcontrollers/digispark/">
        Digispark
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/itsybitsy-m0/" title="ItsyBitsy M0" class="dd-item ">
        <a href="/microcontrollers/itsybitsy-m0/">
        ItsyBitsy M0
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/pca10031/" title="PCA10031" class="dd-item ">
        <a href="/microcontrollers/pca10031/">
        PCA10031
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/pca10040/" title="PCA10040" class="dd-item ">
        <a href="/microcontrollers/pca10040/">
        PCA10040
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/pca10056/" title="PCA10056" class="dd-item ">
        <a href="/microcontrollers/pca10056/">
        PCA10056
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/nrf52840-mdk/" title="nRF52840-MDK" class="dd-item ">
        <a href="/microcontrollers/nrf52840-mdk/">
        nRF52840-MDK
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/microcontrollers/reelboard/" title="reel board" class="dd-item ">
        <a href="/microcontrollers/reelboard/">
        reel board
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/webassembly/" title="WebAssembly (WASM)" class="dd-item 
        
        
        
        ">
      <a href="/webassembly/">
          WebAssembly (WASM)
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/webassembly/webassembly/" title="Using WebAssembly" class="dd-item ">
        <a href="/webassembly/webassembly/">
        Using WebAssembly
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/linux/" title="Linux" class="dd-item 
        
        
        
        ">
      <a href="/linux/">
          Linux
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lang-support/" title="Go language features" class="dd-item 
        
        
        
        ">
      <a href="/lang-support/">
          Go language features
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/faq/" title="FAQ" class="dd-item 
        
        
        
        ">
      <a href="/faq/">
          FAQ
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/faq/what-is-tinygo/" title="What is TinyGo exactly?" class="dd-item ">
        <a href="/faq/what-is-tinygo/">
        What is TinyGo exactly?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/faq/why-a-new-compiler/" title="Why a new compiler?" class="dd-item ">
        <a href="/faq/why-a-new-compiler/">
        Why a new compiler?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/faq/why-go-instead-of-rust/" title="Why Go instead of Rust?" class="dd-item ">
        <a href="/faq/why-go-instead-of-rust/">
        Why Go instead of Rust?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/faq/what-about-esp8266-esp32/" title="What about the ESP8266/ESP32?" class="dd-item ">
        <a href="/faq/what-about-esp8266-esp32/">
        What about the ESP8266/ESP32?
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/compiler-internals/" title="Compiler Internals" class="dd-item 
        parent
        
        
        ">
      <a href="/compiler-internals/">
          Compiler Internals
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/differences-from-go/" title="Differences from Go" class="dd-item ">
        <a href="/compiler-internals/differences-from-go/">
        Differences from Go
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/heap-allocation/" title="Heap allocation" class="dd-item ">
        <a href="/compiler-internals/heap-allocation/">
        Heap allocation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/datatypes/" title="Datatypes" class="dd-item ">
        <a href="/compiler-internals/datatypes/">
        Datatypes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/volatile/" title="The volatile keyword" class="dd-item ">
        <a href="/compiler-internals/volatile/">
        The volatile keyword
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/calling-convention/" title="Calling convention" class="dd-item active">
        <a href="/compiler-internals/calling-convention/">
        Calling convention
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/inline-assembly/" title="Inline assembly" class="dd-item ">
        <a href="/compiler-internals/inline-assembly/">
        Inline assembly
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/harvard-arch/" title="Harvard architectures (AVR)" class="dd-item ">
        <a href="/compiler-internals/harvard-arch/">
        Harvard architectures (AVR)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/microcontrollers/" title="Microcontroller Targets" class="dd-item ">
        <a href="/compiler-internals/microcontrollers/">
        Microcontroller Targets
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/compiler-internals/pipeline/" title="Pipeline" class="dd-item ">
        <a href="/compiler-internals/pipeline/">
        Pipeline
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/tinygo-org/tinygo"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://godoc.org/github.com/tinygo-org/tinygo"><i class='fa fa-book'></i> Godoc</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/TinyGolang"><i class='fab fa-twitter'></i> Twitter</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://gophers.slack.com/messages/CDJD3SUP6/"><i class='fab fa-slack'></i> Slack</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <center style="margin-top: -50px">Please give TinyGo a star!
    <p></p>
    <a class="github-button" href="https://github.com/tinygo-org/tinygo" data-icon="octicon-star" data-show-count="true" aria-label="Star TinyGo on GitHub">Star</a>
    <a class="github-button" href="https://github.com/tinygo-org/tinygo/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork TinyGo on GitHub">Fork</a>
    <p></p>
    <p>Site built with <a href="http://gohugo.io/">Hugo</a></p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/tinygo-org/tinygo-site/edit/master/content/compiler-internals/calling-convention.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Home</a> > <a href='/compiler-internals/'>Compiler Internals</a> > Calling convention
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Calling convention</h1>
          

        


<p>Go uses a stack-based calling convention and passes a pointer to the argument list as the first argument in the function. There were/are <a href="https://github.com/golang/go/issues/18597">plans to switch to a register-based calling convention</a> but they&rsquo;re now on hold.</p>

<p>TinyGo, however, uses a register based calling convention. In fact it is somewhat compatible with the C calling convention but with a few quirks:</p>

<ul>
<li><p>Struct parameters are split into separate arguments, if the number of fields (after flattening recursively) is 3 or lower. This is similar to the <a href="https://github.com/apple/swift/blob/master/docs/CallingConvention.rst#physical-conventions">Swift calling convention</a>. In the case of TinyGo, the size of each field does not matter, a field can even be an array:</p>

<pre><code>{i8*, i32}           -&gt; i8*, i32
{{i8*, i32}, i16}    -&gt; i8*, i32, i16
{{i64}}              -&gt; i64
{}                   -&gt;
{i8*, i32, i8, i8}   -&gt; {i8*, i32, i8, i8}
{{i8*, i32, i8}, i8} -&gt; {{i8*, i32, i8}, i8}
</code></pre>

<p>Note that all native Go data types that are lowered to aggregate types in LLVM are expanded this way: <code>string</code>, slices, interfaces, and fat function pointers. This avoids some overhead in the C calling convention and makes the work of the LLVM optimizers easier.</p></li>

<li><p>The WebAssembly target by default doesn&rsquo;t export or import <code>i64</code> (<code>int64</code>, <code>uint64</code>) parameters. Instead, it replaces them with <code>i64*</code>, allocating the value on the stack. In other words, imported functions are called with a 64-bit integer on the stack and exported functions must be called with a pointer to a 64-bit integer somewhere in linear memory.</p>

<p>This is a workaround for a limitation in JavaScript, which only deals with doubles and can therefore only work with integers up to 32-bit in size (a 64-bit integer cannot be represented exactly in a double, a 32-bit integer can). It is expected that 64-bit integers will be <a href="https://github.com/WebAssembly/design/issues/1172">added in the near future</a> at which point this calling convention workaround may be removed. Also see <a href="https://github.com/rustwasm/wasm-bindgen/issues/35">this wasm-bindgen issue</a>.</p>

<p>Currently there are also non-browser WebAssembly execution environments that do not have this limitation. Use the -wasm-abi=generic flag to remove the behavior described above and enable emitting functions with i64 parameters directly.</p></li>

<li><p>The WebAssembly target does not return variables directly that cannot be handled by JavaScript (see above about <code>i64</code>, also <code>struct</code>, <code>i64</code>, multiple return values, etc). Instead, they are stored into a pointer passed as the first parameter by the caller.</p>

<p>This is the calling convention as implemented by LLVM, with the extension that <code>i64</code> return values are returned in the same way as aggregate types.</p></li>

<li><p>Non-exported functions have two extra <code>i8</code> (roughly equivalent to
<code>unsafe.Pointer</code>) parameters appended at the end of the argument list. The
first extra parameter is the context for when the function is a function
pointer. If it is known not to be a closure, this value may be left
undefined. The second extra parameter is the parent goroutine handle, which
is used only in blocking functions to return to the parent, otherwise it is
also unused and may be left undefined.</p></li>
</ul>

<p>This calling convention may change in the future. Changes will be documented here. However, even though it may change, it is expected that function signatures that only contain integers and pointers will remain stable.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/compiler-internals/volatile/" title="The volatile keyword"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/compiler-internals/inline-assembly/" title="Inline assembly" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1553068548"></script>
    <script src="/js/perfect-scrollbar.min.js?1553068548"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1553068548"></script>
    <script src="/js/jquery.sticky.js?1553068548"></script>
    <script src="/js/featherlight.min.js?1553068548"></script>
    <script src="/js/html5shiv-printshiv.min.js?1553068548"></script>
    <script src="/js/highlight.pack.js?1553068548"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1553068548"></script>
    <script src="/js/learn.js?1553068548"></script>
    <script src="/js/hugo-learn.js?1553068548"></script>

    <link href="/mermaid/mermaid.css?1553068548" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1553068548"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

